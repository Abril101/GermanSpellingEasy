<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>German Spelling City</title>

<style>
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
  background: #f4f6f8;
  margin: 0;
  padding: 0;
}

.container {
  max-width: 600px;
  margin: 40px auto;
  background: white;
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

h1 {
  text-align: center;
}

textarea, input {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  font-size: 16px;
}

textarea {
  min-height: 150px;
  resize: vertical;
}

button {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  font-size: 16px;
  background: #2563eb;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}

button.secondary {
  background: #6b7280;
}

button:hover {
  opacity: 0.9;
}

.hidden {
  display: none;
}

.feedback {
  margin-top: 10px;
  font-weight: bold;
}

.correct { color: green; }
.incorrect { color: red; }

.word-counter {
  text-align: center;
  margin-top: 10px;
  color: #555;
}
</style>
</head>

<body>

<div class="container">

<h1>üá©üá™ German Spelling City</h1>

<!-- SETUP -->
<div id="setup">
  <p>Pega tus palabras (una por l√≠nea):</p>
  <textarea id="wordBox" placeholder="der Freund
die Schule
das Haus"></textarea>

  <button onclick="startTest()">‚ñ∂Ô∏è Empezar dictado</button>
</div>

<!-- TEST -->
<div id="test" class="hidden">
  <button onclick="playAudio()">üîä Escuchar palabra</button>
  <input id="answer" placeholder="Escribe aqu√≠‚Ä¶" autofocus />
  <button onclick="checkAnswer()">Confirmar</button>
  <div id="feedback" class="feedback"></div>
  <div class="word-counter" id="counter"></div>
</div>

<!-- END -->
<div id="end" class="hidden">
  <h2>üéâ Sesi√≥n terminada</h2>
  <button onclick="restart()">Practicar errores</button>
  <button class="secondary" onclick="goHome()">Volver al inicio</button>
</div>

</div>

<script>
let words = [];
let errors = [];
let currentWord = "";
let index = 0;

/* ---------- UTIL ---------- */
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

/* ---------- STORAGE ---------- */
function saveWords(text) {
  localStorage.setItem("germanWords", text);
}

function loadWords() {
  const saved = localStorage.getItem("germanWords") || "";
  document.getElementById("wordBox").value = saved;
}

/* ---------- TEST ---------- */
function startTest() {
  const text = document.getElementById("wordBox").value.trim();
  if (!text) return;

  saveWords(text);

  words = text
    .split("\n")
    .map(w => w.trim())
    .filter(w => w !== "");

  shuffle(words);
  errors = [];
  index = 0;

  document.getElementById("setup").classList.add("hidden");
  document.getElementById("test").classList.remove("hidden");

  nextWord();
}

function playAudio() {
  window.speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(currentWord);
  u.lang = "de-DE";
  setTimeout(() => window.speechSynthesis.speak(u), 80);
}

function nextWord() {
  if (index >= words.length) {
    endSession();
    return;
  }

  currentWord = words[index];
  document.getElementById("answer").value = "";
  document.getElementById("feedback").textContent = "";
  document.getElementById("counter").textContent =
    `Palabra ${index + 1} de ${words.length}`;

  playAudio();
}

function checkAnswer() {
  const input = document.getElementById("answer").value.trim();
  const fb = document.getElementById("feedback");

  if (input === currentWord) {
    fb.textContent = "‚úî Correcto";
    fb.className = "feedback correct";
  } else {
    fb.textContent = `‚úò Incorrecto ‚Äî ${currentWord}`;
    fb.className = "feedback incorrect";
    errors.push(currentWord);
  }

  index++;
  setTimeout(nextWord, 900);
}

function endSession() {
  document.getElementById("test").classList.add("hidden");
  document.getElementById("end").classList.remove("hidden");

  if (errors.length > 0) {
    words = [...errors];
    shuffle(words);
    errors = [];
    index = 0;
  }
}

function restart() {
  document.getElementById("end").classList.add("hidden");
  document.getElementById("test").classList.remove("hidden");
  nextWord();
}

function goHome() {
  document.getElementById("end").classList.add("hidden");
  document.getElementById("setup").classList.remove("hidden");
}

/* ---------- INIT ---------- */
loadWords();
</script>

</body>
</html>
